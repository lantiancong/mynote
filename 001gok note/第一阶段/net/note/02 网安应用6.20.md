

主机先存活 =》端口状态 =》端口利用 =》漏洞扫描 =》漏洞利用





# 端口扫描 （nmap + 网络）

目的：端口状态

nmap：工具/脚本

---

### 存活探测:

#### ICMP Echo：

> ping，多种类型(-PE,-PP,-PM(在局域网中还是先用ARP))，快
>
> sudo	nmap	-PE/-PP/-PM	【-sn】	网段

#### ARP：

> **局域网**，防护墙屏蔽
>
> sudo nmap -sn 网段

#### TCP/UDP请求：

> 复杂环境
>
> sudo nmap -PS80,443,8080 -sn 10.10.68.0/24
>
> sudo nmap -PA -sn 10.10.68.0/24
>
> sudo nmap -PU -sn 10.10.68.220/24

#### ICMP时间戳请求

---

# 端口扫描

#### TCP连接：

> 先TCP连接，易被发现，准确率高
>
> sudo nmap -sT --min-rate 10000 -p-  网段
>
> -sT :TCP参数
>
> --min-rate [num]:最小发包速率（不加会扫很慢，需设备支持，太高可能被屏蔽）
>
> -p-：全端口

#### TCP SYN扫描：

> 半开放，发一回一，SYN->SYN-ACK->RST：(三包)
>
> sudo nmap -sS --min-rate 10000 -p-  网段
>
> -sS：SYN参数

#### UDP:

> 准确率，速率，攻击面相对TCP差很多
>
> 无连接，通常只会扫常见的100到1000个（-F选项）
>
> sudo nmap -sU --min-rate 10000 -p- 172.16.200.131
>
> ![1](..\img\2-1 UDP扫描.png)

#### ACK：

> 检查防火墙行为

## 端口状态

open：正在监听且可响应请求（无拦截）

closed：能访问，可达（**没有被防护墙等安全设备/程序阻拦**）

filtered：不可访问（去，防护墙，回三种可能）

unfiltered：可访问（ACK 扫描(-sA)会遇到）



---

### 笑脸漏洞(匿名登入)

1. 探测到21端口开放，6200端口关闭
2. 检测版本号
3. 利用漏洞
4. 拿到主机，打开6200端口
5. 通过6200端口连接目标主机

> -sV ：获取版本信息
>
> -O：获取系统信息
>
> sudo nmap -sT -sV -O -p 80,111,777,52497,5353,20444 172.16.200.13
>
> *-p后接端口*

##### 扫描结果

![2](..\img\2-2 扫描结果.png)



---

端口信息获取：

-sT -O

---



---

### 脚本

>sudo nmap -sC -p80,111,777 172.16.200.13
>
>-sC :默认脚本参数



>sudo nmap --script=vuln -p80,111,777 172.16.200.13
>
>--script=【vuln】：-script可指定服务，这里是漏扫

---

### nmap    

nmap [协议] --min-rate=1000	-p  [端口]	-oN  [文件]  -v(详细)



> sudo nmap -sn 172.16.200.0/24
>
> sudo nmap -sS  --min-rate=10000-p---defeat-rst-ratelimit -oN ports.nmap -v 10.10.183.12
>
> sudo nmap -sU 10.10.207.202 -F-v
>
> sudo nmap -sU 10.10.207.202 -p--v
>
> sudo nmap -sT  -sV -O -p80,111,777,52497,5353,20444  172.16.200.13   -oN service.nmap
>
> sudo nmap -sT  --script=vuln -p80

---

### 补充

-sV 和-O

![3](..\img\2-3 -sV和-O.png)